<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>席替えツール</title>
    <style>
        :root { --bg: #2b3a42; --teacher-bg: #f3f4f6; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* ヘッダー */
        header { background: #fff; border-bottom: 1px solid #ddd; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 100; position: relative; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-teal { background: #0d9488; color: white; }
        .btn-indigo { background: #4f46e5; color: white; }
        .btn-green { background: #16a34a; color: white; }

        /* レイアウト */
        .wrapper { display: flex; height: calc(100vh - 55px); width: 100vw; }
        aside { width: 280px; background: #fff; border-right: 1px solid #ddd; padding: 20px; overflow-y: auto; display: block; }
        main { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; transition: background 0.3s; }
        .student-mode main { background: var(--bg); }
        .teacher-mode main { background: var(--teacher-bg); }

        /* 黒板 */
        .blackboard { width: 80%; max-width: 600px; height: 40px; background: #1a472a; border: 4px solid #5d4037; border-radius: 4px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.2); letter-spacing: 1em; font-weight: bold; font-size: 12px; flex-shrink: 0; }

        /* 座席グリッド */
        .grid { display: grid; gap: 10px; width: 100%; max-width: 1000px; }
        .seat { aspect-ratio: 5/4; perspective: 1000px; cursor: pointer; }
        .card { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card.flipped { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-sizing: border-box; border: 1px solid #ddd; }
        .front { background: #f0e6d2; color: #8d6e63; }
        .back { transform: rotateY(180deg); color: #333; font-weight: bold; }
        .back.boy { background: #dbeafe; border-color: #bfdbfe; }
        .back.girl { background: #fce7f3; border-color: #fbcfe8; }
        .s-num { font-size: 10px; color: #666; margin-bottom: 2px; }
        .s-name { font-size: 16px; text-align: center; padding: 0 5px; word-break: break-all; }

        /* シャッフルアニメーション */
        @keyframes rumble {
            0% { transform: translate(0,0) rotate(0); }
            25% { transform: translate(2px, -2px) rotate(1deg); }
            50% { transform: translate(-2px, 2px) rotate(-1deg); }
            100% { transform: translate(0,0) rotate(0); }
        }
        .shuffling .card { animation: rumble 0.1s infinite; opacity: 0.7; }

        /* フッター */
        .footer { position: fixed; bottom: 20px; display: flex; gap: 10px; z-index: 100; }
        .teacher-mode aside { display: block; }
        .student-mode aside { display: none; }

        textarea { width: 100%; height: 200px; font-family: monospace; font-size: 12px; padding: 10px; box-sizing: border-box; margin-bottom: 10px; border: 1px solid #ccc; }
        label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #666; }
        .input-group { margin-bottom: 15px; }
        input[type="number"] { width: 100%; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body class="teacher-mode">

<header>
    <div style="font-weight: bold; color: #444;">座席替えツール</div>
    <button class="btn btn-teal" onclick="toggleMode()" id="modeBtn">生徒画面へ</button>
</header>

<div class="wrapper" id="wrapper">
    <aside>
        <div class="input-group">
            <label>名簿 (番号,名前,性別)</label>
            <textarea id="listInput">1, 佐藤 健, 男
2, 鈴木 愛, 女
3, 高橋 翔, 男
4, 田中 美咲, 女
5, 伊藤 翼, 男
6, 渡辺 結衣, 女
7, 山本 蓮, 男
8, 中村 陽菜, 女</textarea>
        </div>
        <div class="input-group">
            <label>レイアウト (縦×横)</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="rowsInput" value="8" min="1" max="10">
                <span style="align-self:center">×</span>
                <input type="number" id="colsInput" value="6" min="1" max="10">
            </div>
        </div>
        <button class="btn btn-indigo" style="width:100%" onclick="applySettings()">設定を反映</button>
    </aside>

    <main id="mainArea">
        <div class="blackboard">BLACKBOARD</div>
        <div id="grid" class="grid"></div>
        
        <div class="footer" id="footerUI" style="display:none;">
            <button class="btn btn-indigo" onclick="shuffle()">シャッフル</button>
            <button class="btn btn-green" onclick="revealAll()">一斉公開</button>
            <button class="btn" style="background:#666; color:white;" onclick="hideAll()">伏せる</button>
        </div>
    </main>
</div>

<script>
    let students = [];
    let currentLayout = [];
    let isTeacherMode = true;

    // 音声
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, dur) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    function toggleMode() {
        isTeacherMode = !isTeacherMode;
        document.body.className = isTeacherMode ? 'teacher-mode' : 'student-mode';
        document.getElementById('modeBtn').innerText = isTeacherMode ? '生徒画面へ' : '設定へ戻る';
        document.getElementById('footerUI').style.display = isTeacherMode ? 'none' : 'flex';
        render();
    }

    function applySettings() {
        const text = document.getElementById('listInput').value;
        const rows = parseInt(document.getElementById('rowsInput').value);
        const cols = parseInt(document.getElementById('colsInput').value);
        
        students = text.trim().split('\n').map((line, i) => {
            const p = line.split(/[,\t]/).map(s => s.trim());
            return { num: p[0], name: p[1] || `生徒${i+1}`, gender: (p[2] && p[2].includes('女')) ? 'girl' : 'boy' };
        });

        currentLayout = [...students];
        // 席数に合わせて調整
        const totalSeats = rows * cols;
        while(currentLayout.length < totalSeats) currentLayout.push(null);
        if(currentLayout.length > totalSeats) currentLayout = currentLayout.slice(0, totalSeats);

        document.getElementById('grid').style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        render();
    }

    function shuffle() {
        document.getElementById('grid').classList.add('shuffling');
        // ドラムロール音の擬似再現
        let count = 0;
        const interval = setInterval(() => {
            playSound(150 + (count * 20), 0.1);
            currentLayout.sort(() => Math.random() - 0.5);
            render();
            count++;
            if (count > 15) {
                clearInterval(interval);
                document.getElementById('grid').classList.remove('shuffling');
                playSound(880, 0.5); // ジャジャーン！
            }
        }, 100);
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        currentLayout.forEach((s, i) => {
            const seat = document.createElement('div');
            seat.className = 'seat';
            if (!s) {
                seat.style.opacity = '0.2';
                grid.appendChild(seat);
                return;
            }
            seat.innerHTML = `
                <div class="card ${isTeacherMode ? 'flipped' : ''}" id="card-${i}">
                    <div class="face front">
                        <span style="opacity:0.2; font-size:24px; font-weight:bold;">${s.num}</span>
                    </div>
                    <div class="face back ${s.gender}">
                        <div class="s-num">${s.num}</div>
                        <div class="s-name">${s.name}</div>
                    </div>
                </div>
            `;
            seat.onclick = () => {
                if(!isTeacherMode) {
                    playSound(600, 0.1);
                    document.getElementById(`card-${i}`).classList.toggle('flipped');
                }
            };
            grid.appendChild(seat);
        });
    }

    function revealAll() {
        playSound(1000, 0.5);
        document.querySelectorAll('.card').forEach(c => c.classList.add('flipped'));
    }

    function hideAll() {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('flipped'));
    }

    // 初期起動
    applySettings();
</script>
</body>
</html>
