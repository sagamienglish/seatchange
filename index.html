<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Word Werewolf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0fdf4;
        }
        h1, h2, h3, .font-english {
            font-family: 'Fredoka', sans-serif;
        }
        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .flipped .card-inner {
            transform: rotateY(180deg);
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-green-400 min-h-[600px] relative">
        <header class="bg-green-500 text-white p-4 text-center">
            <h1 class="text-2xl font-bold tracking-wide">üê∫ Word Werewolf üó£Ô∏è</h1>
            <p class="text-xs opacity-90">English Communication Game</p>
        </header>

        <main id="main-content" class="p-6 flex flex-col items-center justify-center h-full space-y-6">
            <!-- Loading message or initial screen -->
        </main>

        <footer class="absolute bottom-2 w-full text-center text-gray-400 text-xs pb-2">
            English Class Activity Tool
        </footer>
    </div>

    <script>
        const wordSets = [
            { category: "Food", citizen: "Pizza", wolf: "Hamburger" },
            { category: "Food", citizen: "Sushi", wolf: "Sashimi" },
            { category: "Food", citizen: "Coffee", wolf: "Tea" },
            { category: "School", citizen: "Math", wolf: "Science" },
            { category: "School", citizen: "Pencil", wolf: "Pen" },
            { category: "School", citizen: "Library", wolf: "Classroom" },
            { category: "Hobbies", citizen: "Soccer", wolf: "Baseball" },
            { category: "Hobbies", citizen: "YouTube", wolf: "TikTok" },
            { category: "Hobbies", citizen: "Anime", wolf: "Manga" },
            { category: "Animals", citizen: "Cat", wolf: "Dog" },
            { category: "Animals", citizen: "Lion", wolf: "Tiger" },
            { category: "Seasons", citizen: "Summer", wolf: "Winter" },
            { category: "Technology", citizen: "iPhone", wolf: "Android" },
            { category: "Travel", citizen: "Bus", wolf: "Train" }
        ];

        const discussionPhrases = [
            { en: "Is it a food / an animal?", jp: "„Åù„Çå„ÅØÈ£ü„ÅπÁâ©/ÂãïÁâ©„Åß„Åô„ÅãÔºü" },
            { en: "Is it big / small?", jp: "„Åù„Çå„ÅØÂ§ß„Åç„ÅÑ/Â∞è„Åï„ÅÑ„Åß„Åô„ÅãÔºü" },
            { en: "Do you like it?", jp: "„Åù„Çå„ÅØÂ•Ω„Åç„Åß„Åô„ÅãÔºü" },
            { en: "I see it every day.", jp: "ÊØéÊó•Ë¶ã„Åã„Åë„Åæ„Åô„ÄÇ" },
            { en: "It is red / blue.", jp: "„Åù„Çå„ÅØËµ§Ëâ≤/ÈùíËâ≤„Åß„Åô„ÄÇ" },
            { en: "We use it at school.", jp: "Â≠¶Ê†°„Åß‰Ωø„ÅÑ„Åæ„Åô„ÄÇ" },
            { en: "I think it is...", jp: "ÁßÅ„ÅØ„Åù„Çå„ÅØ„Äú„Å†„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ" },
            { en: "Me too. / Really?", jp: "ÁßÅ„ÇÇ„ÄÇ/ Êú¨ÂΩì„Å´Ôºü" }
        ];

        let state = {
            players: 4,
            currentWordSet: {},
            playerRoles: [],
            currentPlayerIndex: 0,
            timerSeconds: 180,
            timerInterval: null
        };

        const appContainer = document.getElementById('main-content');

        function refreshIcons() {
            if (window.lucide) window.lucide.createIcons();
        }

        function renderStartScreen() {
            appContainer.innerHTML = `
                <div class="space-y-6 w-full text-center animate-fade-in">
                    <div class="bg-green-50 p-4 rounded-xl border border-green-200 text-left">
                        <h2 class="font-bold text-lg mb-2 text-center">How to Play</h2>
                        <ul class="text-sm list-disc list-inside space-y-1 text-gray-600">
                            <li>Choose number of players.</li>
                            <li>Pass the phone to check your word.</li>
                            <li>Discuss in English! (Don't say the word!)</li>
                            <li>Find the Wolf (different word).</li>
                        </ul>
                    </div>

                    <div class="space-y-2">
                        <label class="block font-bold text-gray-700">Number of Players</label>
                        <div class="flex justify-center items-center space-x-4">
                            <button onclick="changePlayerCount(-1)" class="w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center font-bold text-xl">-</button>
                            <span id="player-count-display" class="text-2xl font-bold w-8">${state.players}</span>
                            <button onclick="changePlayerCount(1)" class="w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center font-bold text-xl">+</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="startGame('Random')" class="bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-bold shadow-md">üé≤ Random</button>
                        <button onclick="startGame('Food')" class="bg-orange-400 hover:bg-orange-500 text-white py-3 rounded-lg font-bold shadow-md">üçî Food</button>
                        <button onclick="startGame('School')" class="bg-blue-400 hover:bg-blue-500 text-white py-3 rounded-lg font-bold shadow-md">üè´ School</button>
                        <button onclick="startGame('Hobbies')" class="bg-pink-400 hover:bg-pink-500 text-white py-3 rounded-lg font-bold shadow-md">‚öΩ Hobbies</button>
                    </div>
                </div>
            `;
            refreshIcons();
        }

        function changePlayerCount(delta) {
            let newCount = state.players + delta;
            if (newCount >= 3 && newCount <= 8) {
                state.players = newCount;
                document.getElementById('player-count-display').innerText = state.players;
            }
        }

        function startGame(category) {
            let availableSets = wordSets;
            if (category !== 'Random') {
                availableSets = wordSets.filter(s => s.category === category);
            }
            const randomSet = availableSets[Math.floor(Math.random() * availableSets.length)];
            state.currentWordSet = randomSet;

            state.playerRoles = Array(state.players).fill("citizen");
            let wolfIndex = Math.floor(Math.random() * state.players);
            state.playerRoles[wolfIndex] = "wolf";

            state.currentPlayerIndex = 0;
            renderRoleCheck();
        }

        function renderRoleCheck() {
            if (state.currentPlayerIndex >= state.players) {
                renderDiscussion();
                return;
            }

            appContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center w-full h-full space-y-8 animate-fade-in">
                    <div class="text-center">
                        <span class="inline-block p-3 bg-green-100 rounded-full mb-4">
                            <i data-lucide="user" class="w-10 h-10 text-green-600"></i>
                        </span>
                        <h2 class="text-2xl font-bold">Player ${state.currentPlayerIndex + 1}</h2>
                        <p class="text-gray-500">Pass the device to Player ${state.currentPlayerIndex + 1}</p>
                    </div>

                    <div id="card-container" class="relative w-64 h-40 cursor-pointer" onclick="revealCard(this)">
                        <div class="card-inner w-full h-full">
                            <div class="card-front bg-slate-800 text-white rounded-xl shadow-xl flex flex-col items-center justify-center">
                                <i data-lucide="eye" class="w-8 h-8 mb-2"></i>
                                <span class="font-bold text-lg">Tap to see your word</span>
                            </div>
                            <div class="card-back bg-white border-4 border-green-500 text-slate-800 rounded-xl shadow-xl flex flex-col items-center justify-center">
                                <p class="text-xs text-gray-500 uppercase mb-1">Your Word</p>
                                <p id="secret-word" class="text-3xl font-bold font-english text-green-600">???</p>
                            </div>
                        </div>
                    </div>

                    <button id="next-btn" onclick="nextPlayer()" class="hidden w-full bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg">Next Player</button>
                </div>
            `;
            refreshIcons();
        }

        function revealCard(el) {
            if (el.classList.contains('flipped')) return;
            el.classList.add('flipped');
            const role = state.playerRoles[state.currentPlayerIndex];
            document.getElementById('secret-word').innerText = role === 'wolf' ? state.currentWordSet.wolf : state.currentWordSet.citizen;
            setTimeout(() => document.getElementById('next-btn').classList.remove('hidden'), 400);
        }

        function nextPlayer() {
            state.currentPlayerIndex++;
            renderRoleCheck();
        }

        function renderDiscussion() {
            state.timerSeconds = 180;
            appContainer.innerHTML = `
                <div class="w-full h-full flex flex-col animate-fade-in">
                    <div class="text-center mb-4">
                        <h2 class="text-xl font-bold text-gray-700">Discussion Time!</h2>
                        <div class="flex items-center justify-center space-x-2 mt-2">
                             <i data-lucide="timer" class="text-orange-500"></i>
                             <span id="timer-display" class="text-4xl font-mono font-bold text-orange-500">03:00</span>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto bg-gray-50 rounded-xl border p-4 mb-4 shadow-inner">
                        <h3 class="text-sm font-bold text-gray-400 mb-2 uppercase">Useful Phrases</h3>
                        <div class="space-y-2">
                            ${discussionPhrases.map(p => `
                                <div class="bg-white p-3 rounded-lg border shadow-sm">
                                    <p class="font-semibold text-indigo-600">${p.en}</p>
                                    <p class="text-xs text-gray-400">${p.jp}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button onclick="finishDiscussion()" class="w-full bg-red-500 text-white font-bold py-4 rounded-lg shadow-md">Stop & Vote</button>
                </div>
            `;
            refreshIcons();
            startTimer();
        }

        function startTimer() {
            if (state.timerInterval) clearInterval(state.timerInterval);
            state.timerInterval = setInterval(() => {
                state.timerSeconds--;
                const m = Math.floor(state.timerSeconds / 60);
                const s = state.timerSeconds % 60;
                const display = document.getElementById('timer-display');
                if (display) display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                if (state.timerSeconds <= 0) finishDiscussion();
            }, 1000);
        }

        function finishDiscussion() {
            clearInterval(state.timerInterval);
            renderResult();
        }

        function renderResult() {
            const citizenWord = state.currentWordSet.citizen;
            const wolfWord = state.currentWordSet.wolf;
            let list = state.playerRoles.map((role, i) => `
                <div class="flex items-center justify-between p-3 rounded-lg border ${role === 'wolf' ? 'bg-red-50 border-red-200' : 'bg-white border-gray-100'}">
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold">${i + 1}</div>
                        <span class="font-bold">${role === 'wolf' ? wolfWord : citizenWord}</span>
                    </div>
                    <span class="text-[10px] font-bold px-2 py-1 rounded-full ${role === 'wolf' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">${role.toUpperCase()}</span>
                </div>
            `).join('');

            appContainer.innerHTML = `
                <div class="w-full h-full flex flex-col space-y-4 animate-fade-in text-center">
                    <h2 class="text-2xl font-bold text-gray-800">Result</h2>
                    <div class="flex-1 overflow-y-auto space-y-2">${list}</div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 flex justify-around">
                        <div><p class="text-[10px] text-gray-500">Citizen</p><p class="font-bold text-green-700">${citizenWord}</p></div>
                        <div class="w-px h-8 bg-yellow-200"></div>
                        <div><p class="text-[10px] text-gray-500">Wolf</p><p class="font-bold text-red-600">${wolfWord}</p></div>
                    </div>
                    <button onclick="renderStartScreen()" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg">Play Again</button>
                </div>
            `;
            refreshIcons();
        }

        window.onload = renderStartScreen;
    </script>
</body>
</html>
